<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>La Matem√°tica del Trading ¬∑ BTC DCA</title>

<style>
:root{
  --bg:#020a13;
  --card:#071826;
  --accent:#00e5ff;
  --green:#00ff9c;
  --yellow:#ffd166;
  --red:#ff4d4d;
  --text:#eaf6ff;
  --muted:#7fa6c0;
  --glow:0 0 18px rgba(0,229,255,.35);
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#041726,#020a13 60%);
  color:var(--text);
  font-family:Inter,Arial;
}
header{
  padding:22px;
  text-align:center;
  border-bottom:1px solid rgba(0,229,255,.25);
  box-shadow:var(--glow);
}
header h1{
  margin:0;
  font-size:22px;
  letter-spacing:2px;
  color:var(--accent);
}
header p{
  margin:6px 0 0;
  font-size:13px;
  color:var(--muted);
}
.container{
  max-width:1100px;
  margin:30px auto;
  padding:0 20px;
  display:grid;
  gap:20px;
}
.card{
  background:linear-gradient(180deg,#081f30,#061523);
  border-radius:18px;
  padding:26px;
  border:1px solid rgba(0,229,255,.25);
  box-shadow:var(--glow);
}
h2{
  margin:0 0 14px;
  font-size:13px;
  color:var(--accent);
  text-transform:uppercase;
  letter-spacing:1px;
}
.sub{font-size:13px;color:var(--muted)}
.big{font-size:34px;font-weight:800}
input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(0,229,255,.25);
  background:#020a13;
  color:var(--text);
  font-weight:600;
  margin-top:6px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
button{
  margin-top:14px;
  padding:12px;
  border:none;
  border-radius:14px;
  background:linear-gradient(90deg,#00e5ff,#00bcd4);
  font-weight:900;
  cursor:pointer;
  box-shadow:var(--glow);
}

/* Riesgo */
.risk{border:2px solid var(--green)}
.liq{font-size:46px;font-weight:900;text-align:center;margin:12px 0}
.bar{
  background:#020a13;
  height:14px;
  border-radius:10px;
  overflow:hidden;
  border:1px solid rgba(0,229,255,.25);
}
.fill{height:100%;width:0%}
.status{text-align:center;margin-top:10px;font-weight:800}

/* Resultados */
.result{font-size:24px;font-weight:900;color:var(--green)}
.warn{color:var(--red);font-size:13px;text-align:center;margin-top:10px}

/* Tabla */
table{width:100%;border-collapse:collapse;font-size:13px;margin-top:12px}
th,td{
  border:1px solid rgba(0,229,255,.2);
  padding:7px;
  text-align:center;
}
th{background:#020a13;color:var(--accent)}
.safe{background:rgba(0,255,156,.12)}
.warnRow{background:rgba(255,209,102,.18);color:#000}
.danger{background:rgba(255,77,77,.22)}
</style>
</head>

<body>

<header>
  <h1>LA MATEM√ÅTICA DEL TRADING</h1>
  <p>BTC DCA Futures ¬∑ Fees, Funding y Comparativa</p>
</header>

<div class="container">

<!-- CONVERSOR -->
<div class="card">
  <h2>Calculadora r√°pida USDT ‚Üí BTC</h2>
  <div class="grid">
    <div>
      <div class="sub">Inversi√≥n en USDT</div>
      <input id="conv_usdt" value="500">
    </div>
    <div>
      <div class="sub">Precio BTC</div>
      <input id="conv_price" value="80000">
    </div>
  </div>
  <div class="sub" style="margin-top:12px">BTC resultante</div>
  <div class="big" id="conv_btc">‚Äî</div>
  <button onclick="useConvertedBTC()">Usar este BTC como capital</button>
</div>

<!-- CAPITAL -->
<div class="card">
  <h2>Tu capital</h2>
  <div class="grid">
    <div>
      <div class="sub">BTC total (spot)</div>
      <input id="btcTotal" value="0.02">
    </div>
    <div>
      <div class="sub">Precio BTC entrada</div>
      <input id="price" value="80000">
    </div>
  </div>
  <div style="margin-top:12px">
    <div class="sub">% BTC como colateral</div>
    <input id="collateral" value="80">
  </div>
</div>

<!-- ESTRATEGIA -->
<div class="card">
  <h2>Tu estrategia</h2>
  <div class="grid">
    <div><div class="sub">Apalancamiento</div><input id="lev" value="5"></div>
    <div><div class="sub">Entrada inicial (%)</div><input id="entry" value="5"></div>
  </div>
  <div class="grid" style="margin-top:16px">
    <div><div class="sub">DCA por nivel (%)</div><input id="dca" value="2"></div>
    <div><div class="sub">N√∫mero de DCA</div><input id="dcaCount" value="6"></div>
  </div>
  <div style="margin-top:16px"><div class="sub">Distancia DCA (%)</div><input id="step" value="10"></div>
  <div style="margin-top:16px"><div class="sub">Duraci√≥n del trade (d√≠as)</div><input id="days" value="7"></div>
</div>

<!-- RIESGO -->
<div class="card risk">
  <h2>Riesgo de liquidaci√≥n</h2>
  <div class="sub" style="text-align:center">Precio promedio futuros</div>
  <div class="sub" style="text-align:center;font-size:18px" id="out_avg">‚Äî</div>
  <div class="liq" id="out_liq">‚Äî</div>
  <div class="bar"><div class="fill" id="riskFill"></div></div>
  <div class="status" id="riskStatus">‚Äî</div>
</div>

<!-- RESULTADOS -->
<div class="card">
  <h2>Resultado a target</h2>
  <div class="sub">Precio objetivo BTC</div>
  <input id="target" value="100000">

  <div class="sub" style="margin-top:12px">PnL FUTUROS NETO (BTC)</div>
  <div class="result" id="pnlNeto">‚Äî</div>

  <div class="sub">Valor FINAL del sistema (USDT)</div>
  <div class="result" id="out_usdtSystem">‚Äî</div>

  <hr style="margin:16px 0;border-color:rgba(0,229,255,.25)">

  <div class="sub">Solo SPOT (sin futuros)</div>
  <div id="out_spotBTC">‚Äî</div>
  <div id="out_spotUSDT">‚Äî</div>

  <div class="sub" style="margin-top:8px">Diferencia a favor del sistema</div>
  <div id="out_diffBTC">‚Äî</div>
  <div id="out_diffUSDT">‚Äî</div>

  <div class="warn" id="warn"></div>
</div>

<!-- TABLA -->
<div class="card">
  <h2>Detalle DCA por niveles</h2>
  <table>
    <thead>
      <tr>
        <th>Nivel</th>
        <th>Precio</th>
        <th>Margen BTC</th>
        <th>Margen BTC acumulado</th>
        <th>Volumen nocional USDT</th>
        <th>Margen acum</th>
        <th>Promedio</th>
        <th>Liquidaci√≥n</th>
        <th>Riesgo</th>
        <th>Ganancia estimada USDT</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

</div>

<script>
document.querySelectorAll("input").forEach(i=>i.addEventListener("input",calc));
conv_usdt.addEventListener("input",updateConverter);
conv_price.addEventListener("input",updateConverter);

function updateConverter(){
  const u=+conv_usdt.value,p=+conv_price.value;
  if(u>0&&p>0) conv_btc.textContent=(u/p).toFixed(6)+" BTC";
}
function useConvertedBTC(){
  btcTotal.value=parseFloat(conv_btc.textContent);
  calc();
}

function calc(){
  const btc=+btcTotal.value, priceVal=+price.value;
  const col=btc*(+collateral.value/100);
  const levVal=+lev.value, e=+entry.value/100, d=+dca.value/100;
  const n=+dcaCount.value, s=+step.value/100;
  const tgt=+target.value, daysVal=+days.value;

  let prices=[], sizes=[], margins=[], used=0;
  for(let i=0;i<=n;i++){
    const m=col*(i===0?e:d);
    if(used+m>col)break;
    prices.push(priceVal*Math.pow(1-s,i));
    sizes.push(m*levVal);
    margins.push(m);
    used+=m;
  }

  const sizeTotal=sizes.reduce((a,b)=>a+b,0);
  let avg=0;for(let i=0;i<sizes.length;i++)avg+=sizes[i]*prices[i];
  avg/=sizeTotal;

  const free=col-used;
  const liq=avg*(1-free/sizeTotal);
  const risk=(priceVal-liq)/priceVal*100;

  out_avg.textContent=avg.toFixed(0);
  out_liq.textContent=liq.toFixed(0);
  riskFill.style.width=Math.min(risk,100)+"%";
  riskFill.style.background=risk>20?"var(--green)":risk>10?"var(--yellow)":"var(--red)";
  riskStatus.textContent=risk>20?"üü¢ SEGURO":risk>10?"üü° ATENCI√ìN":"üî¥ PELIGRO";

  const pnlBr=sizeTotal*((tgt-avg)/avg);
  const feesTot=sizeTotal*0.00025*2;
  const fundingTot=sizeTotal*0.0001*(daysVal*3);
  const pnlNet=pnlBr-feesTot-fundingTot;

  pnlNeto.textContent=`${pnlNet.toFixed(4)} BTC`;
  const btcFinal=btc+pnlNet;
  out_usdtSystem.textContent=`$${(btcFinal*tgt).toFixed(0)}`;

  out_spotBTC.textContent=`${btc.toFixed(4)} BTC`;
  out_spotUSDT.textContent=`$${(btc*tgt).toFixed(0)}`;
  out_diffBTC.textContent=`${(btcFinal-btc).toFixed(4)} BTC`;
  out_diffUSDT.textContent=`$${((btcFinal-btc)*tgt).toFixed(0)}`;

  warn.textContent=pnlNet<0?"‚ö†Ô∏è Fees y funding superan el movimiento":"";

  renderTable(prices,margins,sizes,col,tgt);
}

function renderTable(prices,margins,sizes,col,target){
  let html="", used=0, sizeAcc=0, btcAcc=0;
  for(let i=0;i<prices.length;i++){
    used+=margins[i];
    sizeAcc+=sizes[i];
    btcAcc+=sizes[i];

    let avg=0;
    for(let j=0;j<=i;j++) avg+=prices[j]*sizes[j];
    avg/=sizeAcc;

    const free=col-used;
    const liq=avg*(1-free/sizeAcc);
    const risk=(prices[i]-liq)/prices[i]*100;
    const gainUSDT=(target-avg)*btcAcc;

    const cls=risk>20?"safe":risk>10?"warnRow":"danger";
    html+=`<tr class="${cls}">
      <td>${i}</td>
      <td>${prices[i].toFixed(0)}</td>
      <td>${sizes[i].toFixed(5)}</td>
      <td>${btcAcc.toFixed(5)}</td>
      <td>$${(sizes[i]*prices[i]).toFixed(0)}</td>
      <td>${used.toFixed(5)}</td>
      <td>${avg.toFixed(0)}</td>
      <td>${liq.toFixed(0)}</td>
      <td>${risk.toFixed(1)}%</td>
      <td>$${gainUSDT.toFixed(0)}</td>
    </tr>`;
  }
  rows.innerHTML=html;
}

updateConverter();
calc();
</script>

</body>
</html>
